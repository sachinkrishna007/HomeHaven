<%- include('./includes/header') %>
<section style="background-color: #ffffff;">
    <div class="container py-5">
      <div class="row">
        <div class="col">
          <nav aria-label="breadcrumb" class="bg-light rounded-3 p-3 mb-4">
            <ol class="breadcrumb mb-0">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item"><a href="#">User</a></li>
              <li class="breadcrumb-item active" aria-current="page">User Profile</li>
            </ol>
          </nav>
        </div>
      </div>
  
      <div class="row">
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <img src="../admin/assets/images/profile/user-1.jpg" alt="avatar"
                class="rounded-circle img-fluid" style="width: 150px;">
              <h5 class="my-3"><h3> <%= user.name %></h3></h1> %></h5>
              <p class="text-muted mb-1"></p>
              <p class="text-muted mb-4"></p>
              <div class="d-flex justify-content-center mb-2">
              </div>
            </div>
          </div>
          <div class="card mb-4 mb-lg-0">
            <div class="card-body p-0">
              <ul class="list-group list-group-flush rounded-3">
                
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                
                 
                  <a href="/orderHistory" class="genric-btn info w-50  mx-auto"  >Order History</a>
                
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                
                 
                  <button type="button" class="genric-btn info w-50  mx-auto" 
                   data-toggle="modal" data-target="#addAddressModal">
                    Add Address
                  </button>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                
                 
                  <a href="/updatePassword" class="genric-btn info  w-50  mx-auto"  >Edit Password</a>
                
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                
                 
                  <a href="/wallet" class="genric-btn info w-50 mx-auto " >Your Wallet</a>
                
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                
                 
                  <a href="/logout" class="genric-btn danger w-50  mx-auto" >Logout</a>
                
                </li>
                <!-- <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                  <i class="fab fa-github fa-lg" style="color: #333333;"></i>
                  <p class="mb-0">mdbootstrap</p>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                  <i class="fab fa-twitter fa-lg" style="color: #55acee;"></i>
                  <p class="mb-0">@mdbootstrap</p>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                  <i class="fab fa-instagram fa-lg" style="color: #ac2bac;"></i>
                  <p class="mb-0">mdbootstrap</p>
                </li> -->
                <!-- <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                  <i class="fab fa-facebook-f fa-lg" style="color: #3b5998;"></i>
                  <p class="mb-0">mdbootstrap</p>
                </li> -->
              </ul>
            </div>
          </div>
        </div>
        <div class="col-lg-8">
          <div class="card mb-4">
            <div class="card-body">
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Full Name:</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted"> <%= user.name %> &nbsp;<%= user.lastName %></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Email:</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0"> <%= user.email %></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Mobile:</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">+91<%= user.mobile %></p>
                </div>
              </div>
              
              <!-- <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Mobile</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">(098) 765-4321</p>
                </div>
              </div> -->
         
              <div class="row" >
                <div class="col-sm-3">
                  <!-- <p class="mb-0">Address</p> -->
                </div>
                <div class="col-sm-9">
                 <!-- Display existing addresses -->

                </div>
              </div>
            </div>
          </div>
          <%   if (user.address.length>0) { %>
            <% user.address.forEach((address, index) => { %>
              <div class="card mb-3">
                <div class="card-body">
                  <h5 class="card-title">Address <%= index + 1 %></h5>
                  <p>Name: <%= address.name %></p>
                  <p>Mobile: <%= address.mobile %></p>
                  <p>Landmark: <%= address.landmark || 'N/A' %></p>
                  <p>City: <%= address.city %></p> 
                  <p>State: <%= address.state %></p>
                  <p>Pincode: <%= address.pincode %></p>
                  <p>District: <%= address.district %></p>
                  <p>Address: <%= address.address %></p>
                  <!-- Add an "Edit Address" button -->
                 <a class="genric-btn success" href="/editAddress/<%= address._id %>">edit</a>
                 <a class="genric-btn danger" href="/deleteAddress/<%= address._id %>">Delete</a>
                
                  </form>
                </div>
                
              </div>
            <% }) %>
          <% } else { %>
            <p>No addresses added yet.</p>
          <% } %>
         <!-- Add an "Edit Profile" button -->
         <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addAddressModal">
          Add Address
        </button> -->
    <!-- Modal for adding address -->
          <div class="modal fade" id="addAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <form id="addAddressForm" method="get">
                  <div class="modal-body">
                    <!-- Address form -->
                    
                    <form>
                      <div class="mb-3">
                          <input type="text" class="form-control" id="name" name="name" required placeholder="Enter Your Name">
                          <div class="error" id="nameError"></div>
                      </div>
                      <div class="mb-3">
                          <input type="tel" class="form-control" id="mobile" name="mobile" pattern="[0-9]{10}" placeholder="Enter Your Mobile Number" required>
                          <div class="error" id="mobileError"></div>
                      </div>
                      <div class="mb-3">
                          <input type="text" class="form-control" id="landmark" name="landmark" placeholder="Landmark">
                      </div>
                      <div class="mb-3">
                          <input type="text" class="form-control" id="city" name="city" required placeholder="City">
                          <div class="error" id="cityError"></div>
                      </div>
                      <div class="mb-3">
                          <input type="text" class="form-control" id="state" name="state" required placeholder="State">
                          <div class="error" id="stateError"></div>
                      </div>
                      <div class="mb-3">
                          <input type="number" class="form-control" id="pincode" name="pincode" required placeholder="Pincode">
                          <div class="error" id="pincodeError"></div>
                      </div>
                      <div class="mb-3">
                          <input type="text" class="form-control" id="district" name="district" required placeholder="District">
                          <div class="error" id="districtError"></div>
                      </div>
                      <div class="mb-3">
                          <textarea class="form-control" id="address" name="address" rows="3" required placeholder="Address"></textarea>
                          <div class="error" id="addressError"></div>
                      </div>
         
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" id="addAddressBtn">Add Address</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <script>
            document.addEventListener("DOMContentLoaded", function() {
                const addAddressForm = document.getElementById("addAddressForm");
                const nameInput = document.getElementById("name");
                const nameError = document.getElementById("nameError");
    
                addAddressForm.addEventListener("submit", function(event) {
                    let valid = true;
    
                    // Clear previous error messages
                    nameError.textContent = "";
    
                    // Validate name
                    if (nameInput.value.trim() === "") {
                        valid = false;
                        nameError.textContent = "Name is required.";
                    }
    
                    // Implement similar checks for other fields
    
                    if (!valid) {
                        event.preventDefault();
                    }
                });
            });
        </script>



    
  </div>
<!-- Edit Profile Form -->

  </section>



  
  <%- include('./includes/footer') %>
  



<!-- Add this script after your form HTML -->
<script>
  document.getElementById("addAddressForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent default form submission
    
    // Collect form data
    const formData = new FormData(event.target);
    
    // Convert form data to an object
    const formDataObject = {};
    formData.forEach((value, key) => {
      formDataObject[key] = value;
    });
    
    // Send a POST request using Fetch API
    fetch("/addAddress", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(formDataObject)
    })
    .then(response => response.json())
    .then(data => {
      $('#addAddressModal').modal('hide');
      // Handle the response data
      location.reload()
      console.log(data);
    })

    .catch(error => {
      // Handle errors
      console.error("Error:", error);
    });
  });
</script>


<script>document.querySelector('form').addEventListener('submit', function(event) {
  const name = document.getElementById('name');
  const mobile = document.getElementById('mobile');
  const city = document.getElementById('city');
  const state = document.getElementById('state');
  const pincode = document.getElementById('pincode');
  const district = document.getElementById('district');
  const address = document.getElementById('address');

  if (!name.value) {
      displayError('nameError', 'Name is required');
      event.preventDefault();
  }

  if (!mobile.validity.valid) {
      displayError('mobileError', 'Please enter a valid 10-digit mobile number');
      event.preventDefault();
  }

  if (!city.value) {
      displayError('cityError', 'City is required');
      event.preventDefault();
  }

  if (!state.value) {
      displayError('stateError', 'State is required');
      event.preventDefault();
  }

  if (!pincode.validity.valid) {
      displayError('pincodeError', 'Please enter a valid pincode');
      event.preventDefault();
  }

  if (!district.value) {
      displayError('districtError', 'District is required');
      event.preventDefault();
  }

  if (!address.value) {
      displayError('addressError', 'Address is required');
      event.preventDefault();
  }
});

function displayError(id, message) {
  const errorElement = document.getElementById(id);
  errorElement.innerText = message;
  errorElement.style.color = 'red';
}
</script>